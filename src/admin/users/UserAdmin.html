<div>
    <table class="table users">
        <thead>
            <tr>
                <th>
                    <a href="?orderBy=id" on:click="orderBy(event, 'id')">#</a>
                </th>
                <th>
                    <a href="?orderBy=name" on:click="orderBy(event, 'name')">
                        {__("Name", "admin-users")}
                    </a>
                </th>
                <th>
                    <a href="?orderBy=email" on:click="orderBy(event, 'email')">
                        {__("Sign-In", "admin-users")}
                    </a>
                </th>
                <th>{__("Status", "admin-users")}</th>
                <th>
                    <a href="?orderBy=createdAt" on:click="orderBy(event, 'createdAt')">
                        {__("Created at", "admin-users")}
                    </a>
                </th>
                <th class="center">{__("Charts", "admin-users")}</th>
                <th>{__("Actions", "admin-users")}</th>
            </tr>
        </thead>
        <tbody class="users">
            {#each list as user}
            <UserAdminRow {user}></UserAdminRow>
            {/each}
        </tbody>
    </table>
    <div class="pull-right">
        <UserAdminPagination
            on:navigate="gotoPage(event)"
            {orderBy}
            {offset}
            {limit}
            {total}
        ></UserAdminPagination>
    </div>
</div>

<script>
    import { parse, stringify } from 'query-string';
    import { __ } from '../../shared/l10n';
    import { getJSON } from '../../shared/utils';
    import UserAdminRow from './UserAdminRow.html';
    import UserAdminPagination from './UserAdminPagination.html';

    export default {
        components: {
            UserAdminRow,
            UserAdminPagination
        },

        data() {
            return {
                list: [],
                orderBy: 'id',
                offset: 0,
                limit: 3,
                total: 0
            };
        },

        helpers: { __ },

        methods: {
            orderBy(event, orderBy) {
                event.preventDefault();
                this.set({ orderBy });
                window.history.replaceState({ orderBy }, '', `/admin/users?orderBy=${orderBy}`);
                this.updateList();
            },

            gotoPage(navState) {
                this.set(navState);
                window.history.replaceState(navState, '', `/admin/users?${stringify(navState)}`);
                this.updateList();
            },

            updateList() {
                const { orderBy, offset, limit } = this.get();
                getJSON(
                    `//datawrapper.local:3000/admin/users?${stringify({ orderBy, offset, limit })}`,
                    data => {
                        if (data && data.list) {
                            this.set({
                                list: data.list,
                                total: data.total
                            });
                        }
                    }
                );
            }
        },

        oncreate() {
            const urlQuery = parse(window.location.search);
            this.set(urlQuery);
            this.updateList();
        }
    };
</script>
