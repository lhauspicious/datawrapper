<ul>
    <table class="table users">
        <thead>
            <tr>
                <th>
                    <a href="?orderBy=id" on:click="orderBy(event, 'id')">#</a>
                </th>
                <th>
                    <a href="?orderBy=name" on:click="orderBy(event, 'name')">
                        {__("Name", "admin-users")}
                    </a>
                </th>
                <th>
                    <a href="?orderBy=email" on:click="orderBy(event, 'email')">
                        {__("Sign-In", "admin-users")}
                    </a>
                </th>
                <th>{__("Status", "admin-users")}</th>
                <th>
                    <a href="?orderBy=createdAt" on:click="orderBy(event, 'createdAt')">
                        {__("Created at", "admin-users")}
                    </a>
                </th>
                <th class="center">{__("Charts", "admin-users")}</th>
                <th>{__("Actions", "admin-users")}</th>
            </tr>
        </thead>
        <tbody class="users">
            {#each users as user}
            <UserAdminRow {user}></UserAdminRow>
            {/each}
        </tbody>
    </table>
</ul>

<script>
    import { __ } from '../../shared/l10n';
    import { getJSON } from '../../shared/utils';
    import UserAdminRow from './UserAdminRow.html';

    export default {
        components: { UserAdminRow },

        data() {
            return {
                users: [],
                orderBy: 'id'
            };
        },

        helpers: { __ },

        methods: {
            orderBy(event, orderBy) {
                event.preventDefault();
                this.set({ orderBy });
                window.history.replaceState({ orderBy }, '', `/admin/users?orderBy=${orderBy}`);
                this.updateList();
            },

            updateList() {
                const { orderBy } = this.get();
                getJSON(`//datawrapper.local:3000/admin/users?orderBy=${orderBy}`, data => {
                    if (data && data.list) {
                        this.set({ users: data.list });
                    }
                });
            }
        },

        oncreate() {
            // 'location: ' + document.location + ', state: ' + JSON.stringify(event.state);

            this.updateList();
        }
    };
</script>
