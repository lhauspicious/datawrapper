<div class="pagination">
    <ul>
        {#each items as item}
        <li class="{item.active ? 'active' : ''}">
            <a href="{item.href}" on:click="navigate(event, item.state)">{item.text}</a>
        </li>
        {/each}
    </ul>
</div>

<script>
    const query = ({ limit, offset }) => `?limit=${limit}&offset=${offset}`;
    const isActive = ({ currentPage, i, pageCount }) =>
        currentPage === i || currentPage === pageCount;

    export default {
        computed: {
            items: ({ total, limit, offset }) => {
                const pageCount = Math.ceil(total / limit);
                const currentPage = Math.ceil(offset / limit);
                return [
                    {
                        text: '«',
                        href: query({ limit, offset: 0 }),
                        active: isActive({ currentPage, pageCount, i: 0 })
                    },
                    ...Array.from({ length: pageCount }, (v, i) => ({
                        text: i + 1,
                        href: query({ limit, offset: i * limit }),
                        active: isActive({ currentPage, i, pageCount }),
                        state: { limit, offset: i * limit }
                    })),
                    {
                        text: '»',
                        href: query({ limit, offset: (pageCount - 1) * limit }),
                        active: isActive({ currentPage, pageCount, i: pageCount - 1 })
                    }
                ];
            }
        },

        methods: {
            navigate(event, state) {
                event.preventDefault();
                this.fire('navigate', state);
            }
        }
    };
</script>
